<!DOCTYPE html>
<html lang="ru"
>
<head>
    <title>Awesome wm key bindings integration - NX</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.hoxnox.com/gentoo/awm-key-integration.html">

        <meta name="author" content="Merder hoxnox Kim <hoxnox@gmail.com>" />
        <meta name="keywords" content="gentoo,vim,tmux,key bindings" />
        <meta name="description" content="I&#39;m using awesome window manager on my gentoo desktop. My configuration evaluate from time to time, like vim&#39;s does for example. These instruments highly optimized for my habits, it is right in my fingers. In this post I&#39;ll show how to extend awesome wm key bindings behind ..." />

    <!-- Enable latex plugin -->




    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.hoxnox.com/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.hoxnox.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.hoxnox.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.hoxnox.com/theme/css/style.css" type="text/css"/>

        <link href="http://blog.hoxnox.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="NX ATOM Feed"/>
        <link href="http://blog.hoxnox.com/rss.xml" type="application/rss+xml" rel="alternate"
              title="NX RSS Feed"/>


        <link href="http://blog.hoxnox.com/feeds/gentoo.atom.xml" type="application/atom+xml" rel="alternate"
              title="NX gentoo ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.hoxnox.com/" class="navbar-brand">
NX            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://blog.hoxnox.com/category/admin.html">Admin</a>
                        </li>
                        <li >
                            <a href="http://blog.hoxnox.com/category/blog.html">Blog</a>
                        </li>
                        <li >
                            <a href="http://blog.hoxnox.com/category/chsheets.html">Chsheets</a>
                        </li>
                        <li >
                            <a href="http://blog.hoxnox.com/category/cxx.html">Cxx</a>
                        </li>
                        <li >
                            <a href="http://blog.hoxnox.com/category/devel.html">Devel</a>
                        </li>
                        <li class="active">
                            <a href="http://blog.hoxnox.com/category/gentoo.html">Gentoo</a>
                        </li>
                        <li >
                            <a href="http://blog.hoxnox.com/category/inet.html">Inet</a>
                        </li>
                        <li >
                            <a href="http://blog.hoxnox.com/category/other.html">Other</a>
                        </li>
                        <li >
                            <a href="http://blog.hoxnox.com/category/sec.html">Sec</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://blog.hoxnox.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.hoxnox.com/gentoo/awm-key-integration.html"
                       rel="bookmark"
                       title="Permalink to Awesome wm key bindings integration">
                        Awesome wm key bindings integration
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-03-16T00:00:00+03:00"> Ср 16 Март 2016</time>
    </span>






<span class="label label-default">Tags</span>
	<a href="http://blog.hoxnox.com/tag/gentoo.html">gentoo</a>
        /
	<a href="http://blog.hoxnox.com/tag/vim.html">vim</a>
        /
	<a href="http://blog.hoxnox.com/tag/tmux.html">tmux</a>
        /
	<a href="http://blog.hoxnox.com/tag/key-bindings.html">key bindings</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>I'm using <a href="http://awesome.naquadah.org/">awesome window manager</a> on my
gentoo desktop. My configuration evaluate from time to time, like vim's
does for example. These instruments highly optimized for my habits, it
is right in my fingers. In this post I'll show how to extend awesome wm
key bindings behind it boundaries to third-party applications with help
of <code>root.fake_input</code>.</p>
<h2>Proposal #1</h2>
<p>Tmux multiplexer has it's own panes and you can switch between them with
combination of prefix and arrow keys. Almost the same we have in awesome
wm. The key of head aches is "almost". It's very hard to switch between
different hot keys. The problem can be solved the problem in awesome
configuration file. All needed is to check client while switching to
next window. If the client is tmux - don't switch, send "prefix + arrow"
instead. The solutions is very easy and effective. The code above</p>
<p>.tmux.conf</p>
<div class="highlight"><pre>set-option -g prefix m-a
set-option -g repeat-time 0
set -g default-terminal &quot;screen-256color&quot;
set -g mode-keys vi
bind-key down select-pane -t:.+
bind-key up select-pane -t:.-
</pre></div>


<p>rc.lua:</p>
<div class="highlight"><pre><span class="p">...</span>

<span class="kd">function</span> <span class="nx">is_tmux</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">string</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">lower</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">),</span> <span class="s2">&quot;tmux&quot;</span><span class="p">)</span> <span class="o">~=</span> <span class="nx">nil</span>
    <span class="nx">or</span> <span class="nx">string</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">lower</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="kr">class</span><span class="p">),</span> <span class="s2">&quot;tmux&quot;</span><span class="p">)</span> <span class="o">~=</span> <span class="nx">nil</span>
    <span class="nx">then</span>
         <span class="k">return</span> <span class="kc">true</span>
    <span class="nx">end</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="nx">end</span>

<span class="kd">function</span> <span class="nx">send_tmux_command</span><span class="p">(</span><span class="nx">cmd</span><span class="p">)</span>
    <span class="nx">keygrabber</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_release&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">)</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_release&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">)</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_release&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
    <span class="nx">waiter</span> <span class="o">=</span> <span class="nx">timer</span><span class="p">({</span><span class="nx">timeout</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">})</span>
    <span class="k">if</span> <span class="nx">cmd</span> <span class="o">==</span> <span class="s1">&#39;up&#39;</span> <span class="nx">then</span>
        <span class="nx">waiter</span><span class="o">:</span><span class="nx">connect_signal</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
            <span class="nx">waiter</span><span class="o">:</span><span class="nx">stop</span><span class="p">()</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">116</span><span class="p">)</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_release&quot;</span><span class="p">,</span> <span class="mi">116</span><span class="p">)</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="nx">end</span><span class="p">)</span>
    <span class="nx">end</span>
    <span class="k">if</span> <span class="nx">cmd</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span> <span class="nx">then</span>
        <span class="nx">waiter</span><span class="o">:</span><span class="nx">connect_signal</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span>
            <span class="nx">waiter</span><span class="o">:</span><span class="nx">stop</span><span class="p">()</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">111</span><span class="p">)</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_release&quot;</span><span class="p">,</span> <span class="mi">111</span><span class="p">)</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="nx">end</span><span class="p">)</span>
    <span class="nx">end</span>
    <span class="nx">waiter</span><span class="o">:</span><span class="nx">start</span><span class="p">()</span>
<span class="nx">end</span>

<span class="nx">globalkeys</span> <span class="o">=</span> <span class="nx">awful</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">table</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span>
    <span class="nx">awful</span><span class="p">.</span><span class="nx">key</span><span class="p">({</span> <span class="nx">modkey</span><span class="p">,</span>           <span class="p">},</span> <span class="s2">&quot;j&quot;</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">()</span>
            <span class="k">if</span> <span class="nx">is_tmux</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">focus</span><span class="p">)</span> <span class="nx">then</span>
                <span class="nx">send_tmux_command</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="nx">awful</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">focus</span><span class="p">.</span><span class="nx">byidx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">client</span><span class="p">.</span><span class="nx">focus</span> <span class="nx">then</span> <span class="nx">client</span><span class="p">.</span><span class="nx">focus</span><span class="o">:</span><span class="nx">raise</span><span class="p">()</span> <span class="nx">end</span>
            <span class="nx">end</span>
        <span class="nx">end</span><span class="p">),</span>
    <span class="nx">awful</span><span class="p">.</span><span class="nx">key</span><span class="p">({</span> <span class="nx">modkey</span><span class="p">,</span>           <span class="p">},</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">()</span>
            <span class="k">if</span> <span class="nx">is_tmux</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">focus</span><span class="p">)</span> <span class="nx">then</span>
                <span class="nx">send_tmux_command</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="nx">awful</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">focus</span><span class="p">.</span><span class="nx">byidx</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nx">client</span><span class="p">.</span><span class="nx">focus</span> <span class="nx">then</span> <span class="nx">client</span><span class="p">.</span><span class="nx">focus</span><span class="o">:</span><span class="nx">raise</span><span class="p">()</span> <span class="nx">end</span>
            <span class="nx">end</span>
        <span class="nx">end</span><span class="p">))</span>

<span class="p">...</span>
</pre></div>


<h2>proposal #2</h2>
<p>There is common recommendation to use vim's native layout switching
(default to <code>&lt;C+^&gt;</code>), when you have more than one keyboard layout to use.
It solves problems with hot keys in vim. Other applications uses
system-wide switcher with it's own key bindings. Similar to the proposal #1
we can tune awesome wm configuration:</p>
<p>.vimrc</p>
<div class="highlight"><pre>inoremap &lt;M-=&gt; &lt;C-^&gt;
cnoremap &lt;M-=&gt; &lt;C-^&gt;
</pre></div>


<p>rc.lua</p>
<div class="highlight"><pre><span class="kd">function</span> <span class="nx">is_vim</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">string</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">lower</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">),</span> <span class="s2">&quot;vim&quot;</span><span class="p">)</span> <span class="o">~=</span> <span class="nx">nil</span>
    <span class="nx">or</span> <span class="nx">string</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">lower</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="kr">class</span><span class="p">),</span> <span class="s2">&quot;vim&quot;</span><span class="p">)</span> <span class="o">~=</span> <span class="nx">nil</span>
    <span class="nx">then</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">end</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="nx">end</span>

<span class="kd">function</span> <span class="nx">switch_key_layout_vimspecial</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">is_vim</span><span class="p">(</span><span class="nx">client</span><span class="p">.</span><span class="nx">focus</span><span class="p">)</span> <span class="nx">then</span>
        <span class="nx">keygrabber</span><span class="p">.</span><span class="nx">stop</span><span class="p">()</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_press&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_release&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
        <span class="nx">root</span><span class="p">.</span><span class="nx">fake_input</span><span class="p">(</span><span class="s2">&quot;key_release&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">mylswitcher</span><span class="p">.</span><span class="k">switch</span><span class="p">()</span>
    <span class="nx">end</span>
<span class="nx">end</span>

<span class="nx">globalkeys</span> <span class="o">=</span> <span class="nx">awful</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">table</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">globalkeys</span><span class="p">,</span>
    <span class="nx">awful</span><span class="p">.</span><span class="nx">key</span><span class="p">({</span><span class="nx">modkey</span><span class="p">,</span> <span class="p">},</span> <span class="s2">&quot;space&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="nx">switch_key_layout_vimspecial</span><span class="p">()</span> <span class="nx">end</span><span class="p">))</span>
</pre></div>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="hypercomments_widget"></div>
        <script type="text/javascript">
        _hcwp = window._hcwp || [];
        _hcwp.push({widget:"Stream", widget_id: 27931});
        (function() {
        if("HC_LOAD_INIT" in window)return;
        HC_LOAD_INIT = true;
        var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
        var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
        hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/27931/"+lang+"/widget.js";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hcc, s.nextSibling);
        })();
        </script>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="http://www.facebook.com/hoxnox"><i class="fa fa-facebook-square fa-lg"></i> facebook</a></li>
                    <li class="list-group-item"><a href="http://twitter.com/hoxnox"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
                    <li class="list-group-item"><a href="http://github.com/hoxnox"><i class="fa fa-github-square fa-lg"></i> github</a></li>
                    <li class="list-group-item"><a href="http://habrahabr.ru/users/hoxnox/"><i class="fa fa-habrahabr-square fa-lg"></i> habrahabr</a></li>
                  </ul>
                </li>



                <li class="list-group-item"><a href="http://blog.hoxnox.com/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group list-inline tagcloud" id="tags">
                    </ul>
                </li>    



        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Merder hoxnox Kim <hoxnox@gmail.com>
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.hoxnox.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.hoxnox.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.hoxnox.com/theme/js/respond.min.js"></script>

    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-29479486-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>